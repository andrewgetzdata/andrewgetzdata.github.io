---
// Theme Toggle Component
// Geist-style pill-shaped segmented control for dark/light mode
---

<div class="theme-switch" role="radiogroup" aria-label="Theme">
  <button role="radio" data-theme-value="dark" aria-checked="true" class="switch-option active">Dark</button>
  <button role="radio" data-theme-value="light" aria-checked="false" class="switch-option">Light</button>
</div>

<style>
  .theme-switch {
    display: flex;
    border: 1px solid var(--border-primary);
    border-radius: var(--radius);
    background: var(--bg-secondary);
    overflow: hidden;
  }

  .switch-option {
    font-family: var(--font-geist-sans);
    font-size: var(--text-xs);
    font-weight: 500;
    padding: var(--space-1) var(--space-3);
    border: none;
    border-radius: 0;
    background: transparent;
    color: var(--text-tertiary);
    cursor: pointer;
    transition: all var(--transition-fast);
    line-height: 1;
  }

  .switch-option:hover {
    color: var(--text-secondary);
  }

  .switch-option:focus {
    outline: 2px solid var(--accent-secondary);
    outline-offset: -2px;
  }

  .switch-option.active {
    background: var(--text-primary);
    color: var(--bg-primary);
  }
</style>

<script>
  function initThemeToggle() {
    const storedTheme = localStorage.getItem('theme');
    const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const theme = storedTheme || (systemPrefersDark ? 'dark' : 'light');

    document.documentElement.setAttribute('data-theme', theme);
    updateToggleUI(theme);
  }

  function updateToggleUI(theme: string) {
    const buttons = document.querySelectorAll('.switch-option');
    buttons.forEach(btn => {
      const val = btn.getAttribute('data-theme-value');
      const isActive = val === theme;
      btn.classList.toggle('active', isActive);
      btn.setAttribute('aria-checked', isActive.toString());
    });
  }

  function setTheme(theme: string) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
    updateToggleUI(theme);
  }

  document.addEventListener('DOMContentLoaded', () => {
    initThemeToggle();

    document.querySelectorAll('.switch-option').forEach(btn => {
      btn.addEventListener('click', () => {
        const theme = btn.getAttribute('data-theme-value');
        if (theme) setTheme(theme);
      });
    });
  });

  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
    if (!localStorage.getItem('theme')) {
      const theme = e.matches ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', theme);
      updateToggleUI(theme);
    }
  });
</script>
